<?xml version="1.0" encoding="UTF-8"?>

<process exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler" name="GSM_SUBWF_PromiseStrategy" xmlns="http://jbpm.org/4.0/jpdl">
  <start continue="async" g="333,0,48,48" name="start1">
    <transition to="Check Workflow Type">
      <script expr="12 hours " g="0,0,80,40" var="AUTOTIME"/>
    </transition>
  </start>
  <custom g="253,502,207,52" name="1st P2P SMS" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="SMSAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="MSG_ID"/>
               </key>
               <value>
                  <object expr="SINGLE_PAYMENT"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Wait For Promise Days"/>
  </custom>
  <state continue="async" g="250,589,212,52" name="Wait For Promise Days">
      <transition g="102,91" name="Payment" to="P2P Extension Action For Payment"/>
      <transition g="-31,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time"/>
      <transition g="12,-4" name="ReleaseSD" to="Release SD"/>
      <transition g="689,835:48,-20" name="ReleaseSuspension" to="Release Suspension"/>
      <transition g="36,-41" name="ReleaseSDandSuspension" to="Release Suspension1"/>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise">
      <timer duedate="${P2P_CURRENT_DUE_DATE}"/>
      <script expr="N" g="0,0,80,40" var="COMMISSION_FLAG"/>
    </transition>
      <transition g="209,615:6,13" name="Hold" to="Set P2P Parameter After Hold"/>
      <transition g="262,905:-5,-20" name="CancelPromise" to="Tickler For Cancel Promise">
      <script expr="N" g="0,0,80,40" var="COMMISSION_FLAG"/>
    </transition>
      <transition g="278,663;298,665:-23,-10" name="InvoiceBalance" to="Wait For Promise Days"/>
      <transition g="150,615:5,19" name="IMPT" to="check CustCode"/>
   </state>
  <decision g="662,1489,230,48" name="Check Promise Status After Payment">
    <transition g="-5,-20" name="KeptPromise" to="Tickler For Kept Promise">
      <condition expr="${P2P_STATUS==&apos;P&apos;}"/>
    </transition>
    <transition g="450,1624:-5,-20" name="No" to="Check Provisioning flag after payment">
      <condition expr="${P2P_STATUS!=&apos;P&apos;}"/>
    </transition>
  </decision>
  <end g="110,1679,125,48" name="BrokenPromise"/>
  <state continue="async" g="594,588,255,52" name="Wait for AutoRelease Max Scheduled Time">
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment"/>
      <transition g="760,556;769,571:-5,-20" name="InvoiceBalance" to="Wait for AutoRelease Max Scheduled Time"/>
      <transition g="646,667;550,637;570,502:-45,-24" name="ContinueWorkflow" to="Check Provisioning flag">
      <timer duedate="${AUTOTIME}"/>
    </transition>
   </state>
  <end g="697,1874,115,48" name="KeptPromise"/>
  <end g="128,897,80,48" name="IMPT"/>
  <end g="123,744,80,48" name="Hold"/>
  <custom g="604,497,110,52" name="Release SD" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="ProvisioningRevampAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="PROVIDING_ACTION"/>
               </key>
               <value>
                  <object expr="ReleaseSD"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WF_STEP_NAME"/>
               </key>
               <value>
                  <object expr="Provisioning Wait"/>
               </value>
            </entry>
         </map>
      </field>
    <transition g="-43,-33" name="ErrorHandler" to="ActionError">
      <script expr="1" g="0,0,80,40" var="ERROR_FLAG"/>
    </transition>
    <transition g="658,679:" to="Provisioning Wait Forever After Release"/>
  </custom>
  <custom g="860,809,195,52" name="Release Suspension" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="ProvisioningRevampAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="PROVIDING_ACTION"/>
               </key>
               <value>
                  <object expr="ReleaseSuspension"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WF_STEP_NAME"/>
               </key>
               <value>
                  <object expr="Provisioning Wait"/>
               </value>
            </entry>
         </map>
      </field>
    <transition g="-5,-20" name="ErrorHandler" to="ActionError">
      <script expr="2" g="0,0,80,40" var="ERROR_FLAG"/>
    </transition>
    <transition to="Provisioning Wait Forever After Release"/>
  </custom>
  <custom g="988,508,200,52" name="Release Suspension1" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="ProvisioningRevampAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="PROVIDING_ACTION"/>
               </key>
               <value>
                  <object expr="ReleaseSuspension"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WF_STEP_NAME"/>
               </key>
               <value>
                  <object expr="Provisioning Wait"/>
               </value>
            </entry>
         </map>
      </field>
    <transition g="-5,-20" name="ErrorHandler" to="ActionError">
      <script expr="3" g="0,0,80,40" var="ERROR_FLAG"/>
    </transition>
    <transition to="Provisioning Wait Between Release Suspension and Release SD"/>
  </custom>
  <custom g="1110,768,115,52" name="Release SD1" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="ProvisioningRevampAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="PROVIDING_ACTION"/>
               </key>
               <value>
                  <object expr="ReleaseSD"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WF_STEP_NAME"/>
               </key>
               <value>
                  <object expr="Provisioning Wait"/>
               </value>
            </entry>
         </map>
      </field>
    <transition g="-5,-20" name="ErrorHandler" to="ActionError">
      <script expr="4" g="0,0,80,40" var="ERROR_FLAG"/>
    </transition>
    <transition to="Provisioning Wait Forever After Release"/>
  </custom>
  <end g="140,1221,125,48" name="CancelPromise"/>
  <custom g="575,998,220,52" name="P2P Extension Action For Payment" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="P"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Check Commission Flag"/>
  </custom>
  <decision g="661,1282,260,48" name="Check Write Off Amount and Document Code">
    <transition g="-5,-20" name="No" to="Check Write Off Amount and Document Code1">
      <condition expr="${WRITEOFF_AMT!=0 || DOCUMENT_CODE_I==&apos;AdvancePayment&apos;}"/>
    </transition>
    <transition g="-5,-20" name="Yes" to="Calculate Commission">
      <condition expr="${WRITEOFF_AMT==0 &amp;&amp; DOCUMENT_CODE_I!=&apos;AdvancePayment&apos;}"/>
    </transition>
  </decision>
  <decision g="858,1282,265,48" name="Check Write Off Amount and Document Code1">
    <transition g="-5,-20" name="Yes" to="Calculate Commission">
      <condition expr="${WRITEOFF_AMT&gt;0 &amp;&amp; DOCUMENT_CODE_I==&apos;AdvancePayment&apos;}"/>
    </transition>
    <transition g="882,1513:-5,-20" name="No" to="Check Promise Status After Payment">
      <condition expr="${WRITEOFF_AMT&lt;=0 || DOCUMENT_CODE_I!=&apos;AdvancePayment&apos;}"/>
    </transition>
  </decision>
  <custom g="606,1388,160,52" name="Calculate Commission" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="CalculateCommission"/>
      </field>
    <transition to="Check Promise Status After Payment"/>
  </custom>
  <decision g="661,1117,165,48" name="Check Commission Flag">
    <transition to="HandleWriteOffAction">
      <condition expr="${COMMISSION_FLAG==&apos;Y&apos;}"/>
    </transition>
    <transition g="1013,1141;1013,1513:" to="Check Promise Status After Payment"/>
  </decision>
  <decision g="332,244,160,48" name="Check Promise Status">
    <transition g="-5,-20" name="P2PSetupSucessful" to="Tickler For P2P Sucessful">
      <condition expr="${P2P_STATUS==&apos;S&apos;}"/>
    </transition>
    <transition g="-47,-19" name="P2PSetupFailed" to="P2PSetupFailed">
      <condition expr="${P2P_STATUS==&apos;F&apos;}"/>
      <script expr="N" g="0,0,80,40" var="COMMISSION_FLAG"/>
    </transition>
  </decision>
  <end g="603,245,130,48" name="P2PSetupFailed"/>
  <custom g="42,1111,210,52" name="Set P2P Parameter After Cancel" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="R"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="CancelPromise"/>
  </custom>
  <custom g="-20,1357,245,52" name="Set P2P Parameter" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="R"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="BrokenPromise"/>
  </custom>
  <custom g="595,1801,235,52" name="Set P2P Parameter After KeptPromise" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="R"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Check KP Source"/>
  </custom>
  <custom g="1054,1103,115,52" name="ActionError" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="DoNothing"/>
      </field>
    <transition to="ActionError Wait"/>
  </custom>
  <state continue="async" g="1328,1104,140,52" name="ActionError Wait">
      <transition g="-5,-20" name="ContinueWorkflow" to="Select State After ActionError Wait">
      <timer duedate="12 hours"/>
    </transition>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment"/>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time"/>
      <transition g="-5,-20" name="IMPT" to="Set P2P Parameter After IMPT"/>
      <transition g="1323,1184;1349,1186:-5,-20" name="InvoiceBalance" to="ActionError Wait"/>
   </state>
  <decision g="1442,924,235,48" name="Select State After ActionError Wait">
    <transition to="Release SD">
      <condition expr="${ERROR_FLAG==&apos;1&apos;}"/>
    </transition>
    <transition to="Release Suspension">
      <condition expr="${ERROR_FLAG==&apos;2&apos;}"/>
    </transition>
    <transition to="Release Suspension1">
      <condition expr="${ERROR_FLAG==&apos;3&apos;}"/>
    </transition>
    <transition to="Release SD1">
      <condition expr="${ERROR_FLAG==&apos;4&apos;}"/>
    </transition>
  </decision>
  <custom g="241,163,230,52" name="P2P Extension Action For verification" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Check Promise Status"/>
  </custom>
  <custom g="264,331,185,52" name="Tickler For P2P Sucessful" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="ALL"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="P2P Setup was completed successfully with the following information- # P2P Due Date: @{P2P_DUE_DATE} # P2P Amount: @{PROMISE_AMOUNT} # P2P BP_ACTION: @{BP_ACTION} # P2P KP_ACTION: @{P2P_KP_ACTION} # P2P Installment Start Date: @{P2P_INSTALLMENT_START_DATE} # P2P Installment Amount: @{P2P_INSTALLMENT_AMOUNT} # P2P Installment Frequency: @{P2P_FREQUENCY} # P2P Installment Recurrence: @{P2P_RECURRENCE}"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="NOTE"/>
               </key>
               <value>
                  <object expr="P2P Setup was completed successfully with the following information- # P2P Due Date: @{P2P_DUE_DATE} # P2P Amount: @{PROMISE_AMOUNT} # P2P BP_ACTION: @{BP_ACTION} # P2P KP_ACTION: @{P2P_KP_ACTION} # P2P Installment Start Date: @{P2P_INSTALLMENT_START_DATE} # P2P Installment Amount: @{P2P_INSTALLMENT_AMOUNT} # P2P Installment Frequency: @{P2P_FREQUENCY} # P2P Installment Recurrence: @{P2P_RECURRENCE}"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Promise to Pay"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="D"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="P2P Extension Action For Initialization"/>
  </custom>
  <custom g="229,412,255,52" name="P2P Extension Action For Initialization" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="I"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="1st P2P SMS"/>
  </custom>
  <decision g="501,1931,135,48" name="Check KP Source">
      <transition to="KeptPromise">
         <condition expr="${PR_TIMEOUT_FLAG!=&apos;1&apos; &amp;&amp; PR_TIMEOUT_FLAG!=&apos;2&apos; &amp;&amp; PR_TIMEOUT_FLAG!=&apos;3&apos; &amp;&amp; PR_TIMEOUT_FLAG!=&apos;4&apos; &amp;&amp; PR_TIMEOUT_FLAG!=&apos;5&apos; &amp;&amp; PR_TIMEOUT_FLAG!=&apos;6&apos; &amp;&amp; PR_TIMEOUT_FLAG!=&apos;7&apos; &amp;&amp; PR_TIMEOUT_FLAG!=&apos;8&apos;}"/>
      </transition>
      <transition to="01-roam-P2P-Cons-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;4&apos; || PR_TIMEOUT_FLAG==&apos;5&apos;}"/>
      </transition>
      <transition to="02-oops-P2P-Cons-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;3&apos; || PR_TIMEOUT_FLAG==&apos;6&apos;}"/>
      </transition>
      <transition to="01-roam-P2P-Corp-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;2&apos; || PR_TIMEOUT_FLAG==&apos;7&apos;}"/>
      </transition>
      <transition to="02-oops -P2P-Corp-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;1&apos; || PR_TIMEOUT_FLAG==&apos;8&apos;}"/>
      </transition>
  </decision>
  <decision g="331,1205,135,48" name="Check BP_ACTION">
    <transition g="-5,-20" name="SD" to="Set P2P Parameter After BP SD">
      <condition expr="${BP_ACTION==&apos;SD&apos;}"/>
    </transition>
    <transition g="-5,-20" name="Suspension" to="Set P2P Parameter After BP Suspension">
      <condition expr="${BP_ACTION==&apos;Suspension&apos;}"/>
    </transition>
    <transition g="-5,-20" name="BrokenPromise" to="Set P2P Parameter">
      <condition expr="${BP_ACTION==&apos;CallOutCustomer&apos;}"/>
    </transition>
  </decision>
  <custom g="207,1407,205,52" name="Set P2P Parameter After BP SD" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="R"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="SD"/>
  </custom>
  <end g="287,1509,31,48" name="SD"/>
  <custom g="392,1467,245,52" name="Set P2P Parameter After BP Suspension" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="R"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Suspension"/>
  </custom>
  <end g="491,1579,110,48" name="Suspension"/>
  <custom g="261,1098,190,52" name="Tickler For Broken Promise" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="ALL"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="S"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Check BP_ACTION"/>
  </custom>
  <custom g="597,1602,180,52" name="Tickler For Kept Promise" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="ALL"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Kept promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Kept promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="S"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Set P2P Parameter After KeptPromise"/>
  </custom>
  <custom g="51,801,200,52" name="Set P2P Parameter After IMPT" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="R"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="IMPT"/>
  </custom>
  <custom g="109,674,200,52" name="Set P2P Parameter After Hold" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="R"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Hold"/>
  </custom>
  <state continue="async" g="986,636,355,52" name="Provisioning Wait Between Release Suspension and Release SD">
      <transition g="-5,-20" name="ContinueWorkflow" to="Release SD1"/>
      <transition g="1176,608;1185,622:-46,-8" name="InvoiceBalance" to="Provisioning Wait Between Release Suspension and Release SD"/>
      <transition g="963,904:-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="1" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="955,614:-75,2" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      	<script expr="1" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="-5,-20" name="IMPT" to="Set P2P Parameter After IMPT"/>
   </state>
  <custom g="606,1200,160,52" name="HandleWriteOffAction" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="HandleWriteOffAction"/>
      </field>
    <transition to="Check Write Off Amount and Document Code"/>
  </custom>
  <custom g="68,954,190,52" name="Tickler For Cancel Promise" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="TICKLER"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Delete promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Delete promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="S"/>
               </value>
            </entry>
         </map>
      </field>
    <transition to="Set P2P Parameter After Cancel"/>
  </custom>
  <decision g="332,80,155,48" name="Check Workflow Type">
    <transition to="P2P Extension Action For verification">
      <condition expr="${WORKFLOW_TYPE==&apos;N&apos;}"/>
    </transition>
    <transition g="65,104;65,437:" to="Wait For Promise Days">
      <condition expr="${WORKFLOW_TYPE==&apos;M&apos;}"/>
    </transition>
  </decision>
  <state continue="async" g="758,713,255,52" name="Provisioning Wait Forever After Release">
      <transition g="924,680;931,695:-36,-3" name="InvoiceBalance" to="Provisioning Wait Forever After Release"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="2" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="845,666:-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      	<script expr="2" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Hold" to="Set P2P Parameter After Hold"/>
      <transition g="-5,-20" name="IMPT" to="Set P2P Parameter After IMPT"/>
      <transition g="580,738:-22,-32" name="ContinueWorkflow" to="Check Release Flag"/>
   </state>
  <decision g="447,831,130,48" name="check CustCode">
    <handler class="com.mobinil.decision.handler.CustCodeValidator"/>
    <transition g="-12,-20" name="T" to="check OOPS OR Roaming flag for Consumer"/>
    <transition g="-11,-20" name="F" to="check OOPS OR Roaming flag for Corporate"/>
  </decision>
  <decision g="308,954,255,48" name="check OOPS OR Roaming flag for Consumer">
    <transition g="-5,-20" name="No" to="02-OOPS-P2P-Cons">
      <condition expr="${ROAMING_REPORT_FLAG!=&apos;Y&apos;}"/>
      <script expr="${calendar:getDate()}" g="0,0,80,40" var="TASK_ENTRY_DATE"/>
    </transition>
    <transition g="-5,-20" name="Yes" to="01-ROAM-P2P-Cons">
      <condition expr="${ROAMING_REPORT_FLAG==&apos;Y&apos;}"/>
      <script expr="${calendar:getDate()}" g="0,0,80,40" var="TASK_ENTRY_DATE"/>
    </transition>
  </decision>
  <decision g="522,932,260,48" name="check OOPS OR Roaming flag for Corporate">
    <transition g="-5,-20" name="Yes" to="01-ROAM-P2P-Corp">
      <condition expr="${ROAMING_REPORT_FLAG==&apos;Y&apos;}"/>
      <script expr="${calendar:getDate()}" g="0,0,80,40" var="TASK_ENTRY_DATE"/>
    </transition>
    <transition g="-5,-20" name="No" to="02-OOPS -P2P-Corp">
      <condition expr="${ROAMING_REPORT_FLAG!=&apos;Y&apos;}"/>
      <script expr="${calendar:getDate()}" g="0,0,80,40" var="TASK_ENTRY_DATE"/>
    </transition>
  </decision>
  <task continue="async" duedate="${P2P_CURRENT_DUE_DATE}" g="-7,1223,140,52" name="01-ROAM-P2P-Cons" startdate="${TASK_ENTRY_DATE}">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="01-ROAM-04-FCRoam"/>
         </field>
      </assignment-handler>
      <transition g="83,1188;103,1186:-5,-20" name="IMPT" to="01-ROAM-P2P-Cons"/>
      <transition g="29,1198;34,1185:-5,-20" name="InvoiceBalance" to="01-ROAM-P2P-Cons"/>
      <transition g="91,1738:-5,-20" name="Hold" to="Reset Roaming Report Flag"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="4" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="4" g="0,0,80,40" var="P2P_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="4" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="4" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="4" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="ContinueWorkflow" to="Reset Roaming Report Flag After P2P timeout">
      <script expr="4" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="SD" to="Reset roaming flag for sdsuspension">
      	<script expr="1" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Suspension" to="Reset roaming flag for sdsuspension">
      	<script expr="2" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="139,1309;128,1270:-5,-20" name="Invoice" to="01-ROAM-P2P-Cons"/>
      <on event="timeout">
         <timer duedate="${P2P_CURRENT_DUE_DATE}" startdate="${TASK_ENTRY_DATE}"/>
         <event-listener class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment">
               <field name="actionName">
                  <string value="ExecuteEventAction"/>
               </field>
         </event-listener>
      </on>
   </task>
  <task continue="async" duedate="${P2P_CURRENT_DUE_DATE}" g="178,1219,140,52" name="02-OOPS-P2P-Cons" startdate="${TASK_ENTRY_DATE}">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="02-OOPS-11-FCOOPS"/>
         </field>
      </assignment-handler>
      <transition g="-5,-20" name="IMPT" to="Check OOPS or Roaming Report Flag"/>
      <transition g="261,1292;287,1304:-5,-20" name="InvoiceBalance" to="02-OOPS-P2P-Cons"/>
      <transition g="-5,-20" name="Hold" to="Reset OOPS Flag"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="3" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="3" g="0,0,80,40" var="P2P_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="3" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="3" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="3" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="ContinueWorkflow" to="Reset Roaming Report Flag After P2P timeout">
      <script expr="3" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="SD" to="Reset oops flag for sdsuspension">
      	<script expr="1" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Suspension" to="Reset oops flag for sdsuspension">
      	<script expr="2" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="328,1327;332,1291:-5,-20" name="Invoice" to="02-OOPS-P2P-Cons"/>
      <on event="timeout">
         <timer duedate="${P2P_CURRENT_DUE_DATE}" startdate="${TASK_ENTRY_DATE}"/>
         <event-listener class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment">
               <field name="actionName">
                  <string value="ExecuteEventAction"/>
               </field>
         </event-listener>
      </on>
   </task>
  <task continue="async" duedate="${P2P_CURRENT_DUE_DATE}" g="381,1192,140,52" name="01-ROAM-P2P-Corp" startdate="${TASK_ENTRY_DATE}">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="01-ROAM-01-Corp"/>
         </field>
      </assignment-handler>
      <transition g="472,1257;501,1248:-5,-20" name="IMPT" to="01-ROAM-P2P-Corp"/>
      <transition g="460,1278;472,1270:-5,-20" name="InvoiceBalance" to="01-ROAM-P2P-Corp"/>
      <transition g="-5,-20" name="Hold" to="Reset Roaming Report Flag"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="2" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="2" g="0,0,80,40" var="P2P_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="2" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="2" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="2" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="ContinueWorkflow" to="Reset Roaming Report Flag After P2P timeout">
       <script expr="2" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="SD" to="Reset roaming flag for sdsuspension">
      	<script expr="1" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Suspension" to="Reset roaming flag for sdsuspension">
      	<script expr="2" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="542,1255;536,1230:-5,-20" name="Invoice" to="01-ROAM-P2P-Corp"/>
      <on event="timeout">
         <timer duedate="${P2P_CURRENT_DUE_DATE}" startdate="${TASK_ENTRY_DATE}"/>
         <event-listener class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment">
               <field name="actionName">
                  <string value="ExecuteEventAction"/>
               </field>
         </event-listener>
      </on>
   </task>
  <task continue="async" duedate="${P2P_CURRENT_DUE_DATE}" g="821,1177,145,52" name="02-OOPS -P2P-Corp" startdate="${TASK_ENTRY_DATE}">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="02-OOPS-01-Corp"/>
         </field>
      </assignment-handler>
      <transition g="-5,-20" name="IMPT" to="Check OOPS or Roaming Report Flag"/>
      <transition g="-5,-20" name="Hold" to="Reset OOPS Flag"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="1" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="1" g="0,0,80,40" var="P2P_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="1" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="1" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="1" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="ContinueWorkflow" to="Reset Roaming Report Flag After P2P timeout">
      <script expr="1" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="SD" to="Reset oops flag for sdsuspension">
      	<script expr="1" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Suspension" to="Reset oops flag for sdsuspension">
      	<script expr="2" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="914,1267;892,1254:-5,-20" name="Invoice" to="02-OOPS -P2P-Corp"/>
      <on event="timeout">
         <timer duedate="${P2P_CURRENT_DUE_DATE}" startdate="${TASK_ENTRY_DATE}"/>
         <event-listener class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment">
               <field name="actionName">
                  <string value="ExecuteEventAction"/>
               </field>
         </event-listener>
      </on>
   </task>
  <decision g="497,428,130,48" name="Check P2P flag">
    <transition to="01-ROAM-P2P-Cons">
      <condition expr="${P2P_FLAG==&apos;4&apos;}"/>
    </transition>
    <transition to="01-roam-P2P-Cons-infinite">
      <condition expr="${P2P_FLAG==&apos;5&apos;}"/>
    </transition>
    <transition to="02-OOPS-P2P-Cons">
      <condition expr="${P2P_FLAG==&apos;3&apos;}"/>
    </transition>
    <transition to="02-oops-P2P-Cons-infinite">
      <condition expr="${P2P_FLAG==&apos;6&apos;}"/>
    </transition>
    <transition to="01-ROAM-P2P-Corp">
      <condition expr="${P2P_FLAG==&apos;2&apos;}"/>
    </transition>
      <transition to="02-OOPS -P2P-Corp">
         <condition expr="${P2P_FLAG==&apos;1&apos;}"/>
      </transition>
      <transition to="02-oops -P2P-Corp-infinite">
         <condition expr="${P2P_FLAG==&apos;8&apos;}"/>
      </transition>
      <transition to="01-roam-P2P-Corp-infinite">
         <condition expr="${P2P_FLAG==&apos;7&apos;}"/>
      </transition>
     <transition to="Wait For Promise Days"/>
  </decision>
  <custom g="2,1830,185,52" name="Reset Roaming Report Flag" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="ROAMING_REPORT_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Set P2P Parameter After Hold"/>
  </custom>
  <custom g="283,1630,150,52" name="Set OOPS Flag IMPT" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="OOPS_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="01-ROAM-P2P-Cons"/>
      <transition to="01-ROAM-P2P-Corp"/>
  </custom>
  <custom g="471,1675,135,52" name="Reset OOPS Flag" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="OOPS_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Set P2P Parameter After Hold"/>
  </custom>
   <decision g="489,1279,225,48" name="Check OOPS or Roaming Report Flag">
      <transition g="410,1296:-5,-20" name="No" to="02-OOPS-P2P-Cons">
         <condition expr="${ROAMING_REPORT_FLAG!=&apos;Y&apos;}"/>
      </transition>
      <transition g="568,1232:-5,-20" name="No" to="02-OOPS -P2P-Corp">
         <condition expr="${ROAMING_REPORT_FLAG!=&apos;Y&apos;}"/>
      </transition>
      <transition g="-5,-20" name="Yes" to="Set OOPS Flag IMPT">
         <condition expr="${ROAMING_REPORT_FLAG==&apos;Y&apos;}"/>
      </transition>
   </decision>
   <custom g="264,1793,275,52" name="Reset Roaming Report Flag After P2P timeout" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="ROAMING_REPORT_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Tickler For Broken Promise after P2P Timeout"/>
   </custom>
   <custom g="276,1872,280,52" name="Tickler For Broken Promise after P2P Timeout" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="ALL"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="S"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="check bp action after timeout"/>
   </custom>
   <decision g="320,2117,180,48" name="Check Task after timeout">
      <transition to="01-roam-P2P-Cons-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;4&apos;}"/>
      </transition>
      <transition to="02-oops-P2P-Cons-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;3&apos;}"/>
      </transition>
      <transition to="01-roam-P2P-Corp-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;2&apos;}"/>
      </transition>
      <transition to="02-oops -P2P-Corp-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;1&apos;}"/>
      </transition>
   </decision>
   <task continue="async" g="-35,2041,185,52" name="01-roam-P2P-Cons-infinite">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="01-ROAM-04-FCRoam"/>
         </field>
      </assignment-handler>
      <transition g="106,2164;112,2143:-5,-20" name="InvoiceBalance" to="01-roam-P2P-Cons-infinite"/>
      <transition g="79,2164;57,2151:-5,-20" name="IMPT" to="01-roam-P2P-Cons-infinite"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="5" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="5" g="0,0,80,40" var="P2P_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="5" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="5" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="5" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="SD" to="Reset roaming flag for sdsuspension">
      	<script expr="1" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Suspension" to="Reset roaming flag for sdsuspension">
      	<script expr="2" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="35,2160;27,2139:-5,-20" name="ContinueWorkflow" to="01-roam-P2P-Cons-infinite">
      <script expr="5" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="145,2121;110,2119:-5,-20" name="Invoice" to="01-roam-P2P-Cons-infinite"/>
   </task>
   <decision g="384,2004,205,48" name="check bp action after timeout">
      <transition g="-72,-20" name="BP action SD" to="Set P2P Parameter After BP SD">
         <condition expr="${BP_ACTION==&apos;SD&apos;}"/>
      </transition>
      <transition g="-117,-20" name="BP action suspension" to="Set P2P Parameter After BP Suspension">
         <condition expr="${BP_ACTION==&apos;Suspension&apos;}"/>
      </transition>
      <transition g="-144,-20" name="BP action calloutcustomer" to="Set P2P parameter after timeout">
         <condition expr="${BP_ACTION==&apos;CallOutCustomer&apos;}"/>
      </transition>
   </decision>
   <task continue="async" g="535,2063,185,52" name="02-oops-P2P-Cons-infinite">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="02-OOPS-11-FCOOPS"/>
         </field>
      </assignment-handler>
      <transition g="91,1738:-5,-20" name="Hold" to="Reset Roaming Report Flag"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="6" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="6" g="0,0,80,40" var="P2P_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="6" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="6" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="6" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="SD" to="Reset roaming flag for sdsuspension">
      	<script expr="1" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Suspension" to="Reset roaming flag for sdsuspension">
      	<script expr="2" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="648,2152;619,2151:-5,-20" name="InvoiceBalance" to="02-oops-P2P-Cons-infinite"/>
      <transition g="707,2145;703,2113:-5,-20" name="IMPT" to="02-oops-P2P-Cons-infinite"/>
      <transition g="561,2138;589,2139:-5,-20" name="ContinueWorkflow" to="02-oops-P2P-Cons-infinite">
      <script expr="6" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="533,2136;548,2113:-5,-20" name="Invoice" to="02-oops-P2P-Cons-infinite"/>
   </task>
   <task continue="async" g="776,1944,190,52" name="01-roam-P2P-Corp-infinite">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="01-ROAM-01-Corp"/>
         </field>
      </assignment-handler>
      <transition g="91,1738:-5,-20" name="Hold" to="Reset Roaming Report Flag"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="7" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="7" g="0,0,80,40" var="P2P_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="7" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="7" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="7" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="SD" to="Reset roaming flag for sdsuspension">
      	<script expr="1" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Suspension" to="Reset roaming flag for sdsuspension">
      	<script expr="2" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="737,2059;724,2044:-5,-20" name="InvoiceBalance" to="01-roam-P2P-Corp-infinite"/>
      <transition g="800,2065;768,2061:-5,-20" name="IMPT" to="01-roam-P2P-Corp-infinite"/>
      <transition g="895,2021;910,2009:-5,-20" name="ContinueWorkflow" to="01-roam-P2P-Corp-infinite">
      <script expr="7" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="842,2056;867,2049:-5,-20" name="Invoice" to="01-roam-P2P-Corp-infinite"/>
   </task>
   <task continue="async" g="889,2046,190,52" name="02-oops -P2P-Corp-infinite">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="02-OOPS-01-Corp"/>
         </field>
      </assignment-handler>
      <transition g="91,1738:-5,-20" name="Hold" to="Reset Roaming Report Flag"/>
      <transition g="-5,-20" name="Payment" to="P2P Extension Action For Payment">
      	<script expr="8" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="8" g="0,0,80,40" var="P2P_FLAG"/>
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
       <script expr="8" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
       <script expr="8" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
       <script expr="8" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
       </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="SD" to="Reset roaming flag for sdsuspension">
      	<script expr="1" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Suspension" to="Reset roaming flag for sdsuspension">
      	<script expr="2" g="0,0,80,40" var="SD_SUSP_FLAG"/>
      </transition>
      <transition g="820,2122;817,2161:-5,-20" name="InvoiceBalance" to="02-oops -P2P-Corp-infinite"/>
      <transition g="934,2139;913,2121:-5,-20" name="IMPT" to="02-oops -P2P-Corp-infinite"/>
      <transition g="1028,2138;995,2129:-5,-20" name="ContinueWorkflow" to="02-oops -P2P-Corp-infinite">
      <script expr="8" g="0,0,80,40" var="PR_TIMEOUT_FLAG"/>
      </transition>
      <transition g="1089,2133;1049,2137:-5,-20" name="Invoice" to="02-oops -P2P-Corp-infinite"/>
   </task>
   <custom g="1277,1267,220,52" name="Reset oops flag for sdsuspension" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="OOPS_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Tickler for broken promise after sdsuspension"/>
   </custom>
   <custom g="1068,1336,235,52" name="Reset roaming flag for sdsuspension" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="ROAMING_REPORT_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Tickler for broken promise after sdsuspension"/>
   </custom>
   <custom g="114,1991,215,52" name="Set P2P parameter after timeout" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="P2PExtensionAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="R"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Check Task after timeout"/>
   </custom>
   <custom g="1263,1448,285,52" name="Tickler for broken promise after sdsuspension" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="ALL"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="S"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="check sd or suspension"/>
   </custom>
   <decision g="1379,1568,170,48" name="check sd or suspension">
      <transition to="Set P2P Parameter After BP SD">
         <condition expr="${SD_SUSP_FLAG==&apos;1&apos;}"/>
      </transition>
      <transition to="Set P2P Parameter After BP Suspension">
         <condition expr="${SD_SUSP_FLAG==&apos;2&apos;}"/>
      </transition>
   </decision>
   <decision g="453,649,150,48" name="Check Release Flag">
      <transition to="01-ROAM-P2P-Cons">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;4&apos;}"/>
      </transition>
      <transition to="02-OOPS-P2P-Cons">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;3&apos;}"/>
      </transition>
      <transition to="01-ROAM-P2P-Corp">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;2&apos;}"/>
      </transition>
      <transition to="02-OOPS -P2P-Corp">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;1&apos;}"/>
      </transition>
      <transition to="01-roam-P2P-Cons-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;5&apos;}"/>
      </transition>
      <transition to="02-oops-P2P-Cons-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;6&apos;}"/>
      </transition>
      <transition to="01-roam-P2P-Corp-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;7&apos;}"/>
      </transition>
      <transition to="02-oops -P2P-Corp-infinite">
         <condition expr="${PR_TIMEOUT_FLAG==&apos;8&apos;}"/>
      </transition>
       <transition to="Wait For Promise Days"/>
   </decision>
   <decision g="618,392,175,48" name="Check Provisioning flag">
      <transition to="Check P2P flag">
         <condition expr="${PROV_PAY_FLAG!=&apos;1&apos; &amp;&amp; PROV_PAY_FLAG!=&apos;2&apos;}"/>
      </transition>
      <transition to="Provisioning Wait Between Release Suspension and Release SD">
         <condition expr="${PROV_PAY_FLAG==&apos;1&apos;}"/>
      </transition>
      <transition to="Provisioning Wait Forever After Release">
         <condition expr="${PROV_PAY_FLAG==&apos;2&apos;}"/>
      </transition>
   </decision>
   <decision g="154,1480,245,48" name="Check Provisioning flag after payment">
      <transition to="Wait For Promise Days">
         <condition expr="${PROV_PAY_FLAG!=&apos;1&apos; &amp;&amp; PROV_PAY_FLAG!=&apos;2&apos;}"/>
      </transition>
      <transition to="Provisioning Wait Forever After Release">
         <condition expr="${PROV_PAY_FLAG==&apos;2&apos;}"/>
      </transition>
      <transition to="Provisioning Wait Between Release Suspension and Release SD">
         <condition expr="${PROV_PAY_FLAG==&apos;1&apos;}"/>
      </transition>
   </decision>
</process>