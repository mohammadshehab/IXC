<?xml version="1.0" encoding="UTF-8"?>

<process exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler" name="GSM_SUBWF_PaymentPlanSubWF" xmlns="http://jbpm.org/4.0/jpdl">
   <start continue="async" g="447,0,48,48" name="start1">
      <transition to="Check Payment Plan Criteria">
      </transition>
   </start>
   <state continue="sync" g="363,487,215,52" name="Wait Until Installment Due Date">
      <transition g="750,616:-5,-20" name="ReleaseSD" to="Release SD"/>
      <transition g="971,616:-5,-20" name="ReleaseSuspension" to="Release Suspension"/>
      <transition g="1015,555:-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1"/>
      <transition g="531,446;548,466:-5,-20" name="Installment" to="Wait Until Installment Due Date"/>
      <transition g="-5,-20" name="CancelPaymentPlan" to="Tickler For Cancel PaymentPlan">
          <script expr="N" g="0,0,80,40" var="COMMISSION_FLAG"/>
      </transition>
      <transition g="142,579:5,-19" name="BrokenPromise" to="Tickler For Broken Promise">
         <timer duedate="1 day" startdate="${CURRENT_INSTALLMENT_DATE}"/>
             <script expr="N" g="0,0,80,40" var="COMMISSION_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Payment" to="Check Commission Flag"/>
      <transition g="391,587:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
      <transition g="403,605:-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="313,499;314,473:-45,1" name="AutoRelease" to="Wait Until Installment Due Date"/>
      <transition g="719,512:58,-19" name="Hold" to="Cancel Payment Plan For Hold"/>
      <transition g="428,425:-126,-18" name="PaymentPlanModified" to="Wait For Modify Payment Plan"/>
      <transition g="362,571:-5,-20" name="CreditNote" to="Check Commission Flag"/>
      <transition g="266,535:-5,-20" name="InvoiceAdjustment" to="Check Commission Flag"/>
      <transition g="-5,-20" name="IMPT" to="Check Custcode"/>
   </state>
   <custom g="381,718,180,52" name="Check Installment Amount" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="CheckInstallmentPaymentAction"/>
      </field>
      <transition to="Is Installment Paid"/>
   </custom>
   <decision g="447,838,155,48" name="Is Installment Paid">
      <transition g="2,-15" name="Yes" to="Is Last Installment">
         <condition expr="${IS_CURRENT_INSTALLMENT_PAID == &apos;T&apos;}"/>
      </transition>
      <transition g="334,862;274,904:18,138" name="No" to="Decide Next state">
         <condition expr="${IS_CURRENT_INSTALLMENT_PAID == &apos;F&apos;}"/>
      </transition>
   </decision>
   <decision g="341,976,155,48" name="Is Last Installment">
      <transition g="12,-20" name="KeptPromise" to="Tickler For Kept Promise">
         <condition expr="${IS_LAST_INSTALLMENT == &apos;T&apos;}"/>
             <script expr="N" g="0,0,80,40" var="COMMISSION_FLAG"/>
      </transition>
      <transition g="308,940:3,-11" name="No" to="Check Installment Amount">
         <condition expr="${IS_LAST_INSTALLMENT == &apos;F&apos;}"/>
      </transition>
   </decision>
   <end g="352,1262,115,48" name="KeptPromise"/>
   <end g="120,1338,125,48" name="BrokenPromise"/>
   <end g="697,298,80,48" name="IMPT"/>
   <end g="1206,491,80,48" name="Hold"/>
   <custom g="696,748,110,52" name="Release SD" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="ProvisioningRevampAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="PROVIDING_ACTION"/>
               </key>
               <value>
                  <object expr="ReleaseSD"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WF_STEP_NAME"/>
               </key>
               <value>
                  <object expr="Provisioning Wait"/>
               </value>
            </entry>
         </map>
      </field>
      <transition g="-5,-20" name="ErrorHandler" to="ActionError">
           <script expr="1" g="0,0,80,40" var="ERROR_FLAG"/>
      </transition>
      <transition g="925,960:" to="Provisioning Wait Forever After Release"/>
   </custom>
   <custom g="1347,891,200,52" name="Release Suspension1" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="ProvisioningRevampAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="PROVIDING_ACTION"/>
               </key>
               <value>
                  <object expr="ReleaseSuspension"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WF_STEP_NAME"/>
               </key>
               <value>
                  <object expr="Provisioning Wait"/>
               </value>
            </entry>
         </map>
      </field>
      <transition g="-5,-20" name="ErrorHandler" to="ActionError">
           <script expr="3" g="0,0,80,40" var="ERROR_FLAG"/>
      </transition>
      <transition to="Provisioning Wait Between Release Suspension and Release SD"/>
   </custom>
   <custom g="1389,1131,115,52" name="Release SD1" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="ProvisioningRevampAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="PROVIDING_ACTION"/>
               </key>
               <value>
                  <object expr="ReleaseSD"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WF_STEP_NAME"/>
               </key>
               <value>
                  <object expr="Provisioning Wait"/>
               </value>
            </entry>
         </map>
      </field>
      <transition g="-5,-20" name="ErrorHandler" to="ActionError">
           <script expr="4" g="0,0,80,40" var="ERROR_FLAG"/>
      </transition>
      <transition to="Provisioning Wait Forever After Release"/>
   </custom>
   <custom g="946,913,195,52" name="Release Suspension" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="ProvisioningRevampAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="PROVIDING_ACTION"/>
               </key>
               <value>
                  <object expr="ReleaseSuspension"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WF_STEP_NAME"/>
               </key>
               <value>
                  <object expr="Provisioning Wait"/>
               </value>
            </entry>
         </map>
      </field>
      <transition g="-5,-20" name="ErrorHandler" to="ActionError">
           <script expr="2" g="0,0,80,40" var="ERROR_FLAG"/>
      </transition>
      <transition g="1070,1022:" to="Provisioning Wait Forever After Release"/>
   </custom>
   <end g="692,964,145,48" name="CancelPaymentPlan"/>
   <decision g="199,722,260,48" name="Check Write Off Amount and Document Code">
      <transition g="-5,-20" name="No" to="Check Write Off Amount and Document Code1">
         <condition expr="${WRITEOFF_AMT!=0 || DOCUMENT_CODE_I==&apos;AdvancePayment&apos;}"/>
      </transition>
      <transition g="-5,-20" name="Yes" to="Calculate Commission">
         <condition expr="${WRITEOFF_AMT==0 &amp;&amp; DOCUMENT_CODE_I!=&apos;AdvancePayment&apos;}"/>
      </transition>
   </decision>
   <decision g="285,722,265,48" name="Check Write Off Amount and Document Code1">
      <transition g="-5,-20" name="No" to="Check Installment Amount">
         <condition expr="${WRITEOFF_AMT&lt;=0 || DOCUMENT_CODE_I!=&apos;AdvancePayment&apos;}"/>
      </transition>
      <transition g="-5,-20" name="Yes" to="Calculate Commission">
         <condition expr="${WRITEOFF_AMT&gt;0 &amp;&amp; DOCUMENT_CODE_I==&apos;AdvancePayment&apos;}"/>
      </transition>
   </decision>
   <custom g="143,839,160,52" name="Calculate Commission" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="CalculateCommission"/>
      </field>
      <transition to="Check Installment Amount"/>
   </custom>
   <decision g="217,574,165,48" name="Check Commission Flag">
      <transition to="HandleWriteOffAction">
         <condition expr="${COMMISSION_FLAG==&apos;Y&apos;}"/>
      </transition>
      <transition to="Check Installment Amount">
      </transition>
   </decision>
   <custom g="878,1332,115,52" name="ActionError" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="DoNothing"/>
      </field>
      <transition to="ActionError Wait"/>
   </custom>
   <state continue="async" g="1118,1331,140,52" name="ActionError Wait">
      <transition g="-5,-20" name="ContinueWorkflow" to="Select State After ActionError Wait">
         <timer duedate="12 hours"/>
      </transition>
      <transition g="-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
      <transition g="666,981:-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="676,1030:-5,-20" name="Payment" to="Check Commission Flag"/>
      <transition g="-5,-20" name="IMPT" to="Cancel Payment Plan For IMPT"/>
   </state>
   <decision g="1290,1230,235,48" name="Select State After ActionError Wait">
      <transition to="Release Suspension">
         <condition expr="${ERROR_FLAG==&apos;2&apos;}"/>
      </transition>
      <transition to="Release SD">
         <condition expr="${ERROR_FLAG==&apos;1&apos;}"/>
      </transition>
      <transition to="Release Suspension1">
         <condition expr="${ERROR_FLAG==&apos;3&apos;}"/>
      </transition>
      <transition to="Release SD1">
         <condition expr="${ERROR_FLAG==&apos;4&apos;}"/>
      </transition>
   </decision>
   <decision g="446,247,195,48" name="Check Payment Plan Criteria">
      <handler class="com.mobinil.decision.handler.InstallmentValidator"/>
      <transition g="-5,-20" name="PPSetupFailed" to="PPSetupFailed">
          <script expr="N" g="0,0,80,40" var="COMMISSION_FLAG"/>
      </transition>
      <transition g="9,-8" name="PPSetupSucessful" to="Tickler For Create PaymentPlan">
      </transition>
   </decision>
   <end g="728,248,125,48" name="PPSetupFailed"/>
   <custom g="40,486,210,52" name="Tickler For Modify PaymentPlan" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="TICKLER"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Modify Payment Plan Details ${INSTALLMENT_DETAILS}"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Modify Payment Plan"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="D"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Wait Until Installment Due Date"/>
   </custom>
   <custom g="366,354,210,52" name="Tickler For Create PaymentPlan" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="TICKLER"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Payment Plan Details ${INSTALLMENT_DETAILS}"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Installment"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="D"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Wait Until Installment Due Date"/>
   </custom>
   <custom g="507,795,210,52" name="Tickler For Cancel PaymentPlan" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="TICKLER"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Deleted Payment Plan details ${INSTALLMENT_DETAILS}"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Cancel payment plan"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="D"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="CancelPaymentPlan"/>
   </custom>
   <custom g="48,1014,190,52" name="Tickler For Broken Promise" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="ALL"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="S"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Cancel Payment Plan For Broken Promise"/>
   </custom>
   <custom g="274,1127,180,52" name="Tickler For Kept Promise" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="ALL"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Kept promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Kept promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="S"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="KeptPromise"/>
   </custom>
   <custom g="18,1189,250,52" name="Cancel Payment Plan For Broken Promise" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="CancelPaymentPlanAction"/>
      </field>
      <transition to="BrokenPromise"/>
   </custom>
   <custom g="620,404,200,52" name="Cancel Payment Plan For IMPT" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="CancelPaymentPlanAction"/>
      </field>
      <transition to="IMPT"/>
   </custom>
   <custom g="889,487,200,52" name="Cancel Payment Plan For Hold" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="CancelPaymentPlanAction"/>
      </field>
      <transition to="Hold"/>
   </custom>
   <state continue="async" g="1266,1001,355,52" name="Provisioning Wait Between Release Suspension and Release SD">
      <transition g="-5,-20" name="ContinueWorkflow" to="Release SD1">
      </transition>
      <transition g="1535,962;1545,981:-5,-20" name="AutoRelease" to="Provisioning Wait Between Release Suspension and Release SD"/>
      <transition g="828,766:-5,-20" name="Payment" to="Check Commission Flag">
      	<script expr="1" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="832,754:-5,-20" name="InvoiceBalance" to="Check Commission Flag">
      	<script expr="1" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="834,740:-5,-20" name="Invoice" to="Check Commission Flag">
      	<script expr="1" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="830,727:-5,-20" name="InvoiceAdjustment" to="Check Commission Flag">
      	<script expr="1" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="835,714:-5,-20" name="CreditNote" to="Check Commission Flag">
      	<script expr="1" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="-5,-20" name="IMPT" to="Cancel Payment Plan For IMPT"/>
   </state>
   <custom g="144,640,160,52" name="HandleWriteOffAction" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="HandleWriteOffAction"/>
      </field>
      <transition to="Check Write Off Amount and Document Code"/>
   </custom>
   <state continue="async" g="46,400,200,52" name="Wait For Modify Payment Plan">
      <transition g="-17,-12" name="ContinueWorkflow" to="Tickler For Modify PaymentPlan">
         <timer duedate="5 seconds"/>
      </transition>
   </state>
   <state continue="async" g="1037,1053,255,52" name="Provisioning Wait Forever After Release">
      <transition g="943,1078:-5,-20" name="ContinueWorkflow" to="Wait Until Installment Due Date"/>
      <transition g="-5,-20" name="AutoRelease" to="Provisioning Wait Forever After Release"/>
      <transition g="654,786:-5,-20" name="Payment" to="Check Commission Flag">
      	<script expr="2" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="657,864;467,720:-5,-20" name="InvoiceBalance" to="Check Commission Flag">
      	<script expr="2" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="651,769:-5,-20" name="Invoice" to="Check Commission Flag">
      	<script expr="2" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="627,786:-21,-11" name="InvoiceAdjustment" to="Check Commission Flag">
      	<script expr="2" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="656,875:-5,-20" name="CreditNote" to="Check Commission Flag">
      	<script expr="2" g="0,0,80,40" var="PROV_PAY_FLAG"/>
      </transition>
      <transition g="-5,-20" name="IMPT" to="Cancel Payment Plan For IMPT"/>
      <transition g="-5,-20" name="Hold" to="Cancel Payment Plan For Hold"/>
   </state>
   <decision g="579,981,130,48" name="Check Custcode">
      <handler class="com.mobinil.decision.handler.CustCodeValidator"/>
      <transition g="-6,-17" name="T" to="Check OOPS or Roaming Report Flag for Consumer"/>
      <transition g="-2,-17" name="F" to="Check OOPS or Roaming Report Flag for Corporate"/>
   </decision>
   <decision g="524,1086,290,48" name="Check OOPS or Roaming Report Flag for Consumer">
      <transition g="-5,-20" name="Yes" to="01-ROAM-PP-Cons">
         <condition expr="${ROAMING_REPORT_FLAG==&apos;Y&apos;}"/>
      </transition>
      <transition g="-5,-20" name="No" to="02-OOPS-PP-Cons">
         <condition expr="${ROAMING_REPORT_FLAG!=&apos;Y&apos;}"/>
      </transition>
   </decision>
   <decision g="638,1081,295,48" name="Check OOPS or Roaming Report Flag for Corporate">
      <transition g="-5,-20" name="Yes" to="01-ROAM-PP-Corp">
         <condition expr="${ROAMING_REPORT_FLAG==&apos;Y&apos;}"/>
      </transition>
      <transition g="-5,-20" name="No" to="02-OOPS -PP-Corp">
         <condition expr="${ROAMING_REPORT_FLAG!=&apos;Y&apos;}"/>
      </transition>
   </decision>
   <task continue="async" duedate="${P2P_CURRENT_DUE_DATE}" g="169,1250,135,52" name="01-ROAM-PP-Cons" startdate="${TASK_ENTRY_DATE}">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="01-ROAM-04-FCRoam"/>
         </field>
      </assignment-handler>
      <transition g="331,1342;365,1328:-5,-20" name="IMPT" to="01-ROAM-PP-Cons"/>
      <transition g="-5,-20" name="Hold" to="Reset Roaming Report Flag ">
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
       <script expr="4" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
       <script expr="4" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
       <script expr="4" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="4" g="0,0,80,40" var="PP_FLAG"/>
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="ContinueWorkflow" to="Reset Roaming Report Flag After  PP timeout">
      <script expr="4" g="0,0,80,40" var="PP_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount">
      </transition>
      <transition g="-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="249,942:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
      <on event="timeout">
         <timer duedate="${P2P_CURRENT_DUE_DATE}" startdate="${TASK_ENTRY_DATE}"/>
         <event-listener class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment">
               <field name="actionName">
                  <string value="ExecuteEventAction"/>
               </field>
         </event-listener>
      </on>
   </task>
   <custom g="855,1623,190,52" name="Reset Roaming Report Flag " class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="ROAMING_REPORT_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Cancel Payment Plan For Hold"/>
   </custom>
   <task continue="async" duedate="${P2P_CURRENT_DUE_DATE}" g="425,1225,135,52" name="02-OOPS-PP-Cons" startdate="${TASK_ENTRY_DATE}">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="02-OOPS-11-FCOOPS"/>
         </field>
      </assignment-handler>
      <transition g="-5,-20" name="IMPT" to="Check OOPS or Roaming Report Flag"/>
      <transition g="-5,-20" name="Hold" to="Reset OOPS Flag "/>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
       <script expr="3" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
       <script expr="3" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
       <script expr="3" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="ContinueWorkflow" to="Reset Roaming Report Flag After  PP timeout">
      <script expr="3" g="0,0,80,40" var="PP_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount">
      </transition>
      <transition g="-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="407,929:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
      <on event="timeout">
         <timer duedate="${P2P_CURRENT_DUE_DATE}" startdate="${TASK_ENTRY_DATE}"/>
         <event-listener class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment">
               <field name="actionName">
                  <string value="ExecuteEventAction"/>
               </field>
         </event-listener>
      </on>
   </task>
   <custom g="1,1643,140,52" name="Reset OOPS Flag " class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="OOPS_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Cancel Payment Plan For Hold"/>
   </custom>
   <decision g="667,1671,225,48" name="Check OOPS or Roaming Report Flag">
      <transition g="-5,-20" name="Yes" to="Set OOPS Flag IMPT">
         <condition expr="${ROAMING_REPORT_FLAG==&apos;Y&apos;}"/>
      </transition>
      <transition g="551,1402:-5,-20" name="No" to="02-OOPS-PP-Cons">
         <condition expr="${ROAMING_REPORT_FLAG!=&apos;Y&apos;}"/>
      </transition>
      <transition g="383,1616:-5,-20" name="Yes" to="Set OOPS Flag IMPT">
         <condition expr="${ROAMING_REPORT_FLAG==&apos;Y&apos;}"/>
      </transition>
      <transition g="669,1481:-5,-20" name="No" to="02-OOPS -PP-Corp">
         <condition expr="${ROAMING_REPORT_FLAG!=&apos;Y&apos;}"/>
      </transition>
   </decision>
   <custom g="148,1420,150,52" name="Set OOPS Flag IMPT" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="01-ROAM-PP-Cons"/>
      <transition to="01-ROAM-PP-Corp"/>
   </custom>
   <task continue="async" duedate="${P2P_CURRENT_DUE_DATE}" g="618,1260,135,52" name="01-ROAM-PP-Corp" startdate="${TASK_ENTRY_DATE}">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="01-ROAM-01-Corp"/>
         </field>
      </assignment-handler>
      <transition g="650,1244;679,1239:-5,-20" name="IMPT" to="01-ROAM-PP-Corp"/>
      <transition g="-5,-20" name="Hold" to="Reset Roaming Report Flag "/>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
       <script expr="2" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="2" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="2" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="2" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="ContinueWorkflow" to="Reset Roaming Report Flag After  PP timeout">
      <script expr="2" g="0,0,80,40" var="PP_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount">
      </transition>
      <transition g="-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="411,850:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
      <on event="timeout">
         <timer duedate="${P2P_CURRENT_DUE_DATE}" startdate="${TASK_ENTRY_DATE}"/>
         <event-listener class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment">
               <field name="actionName">
                  <string value="ExecuteEventAction"/>
               </field>
         </event-listener>
      </on>
   </task>
   <task continue="async" duedate="${P2P_CURRENT_DUE_DATE}" g="790,1220,140,52" name="02-OOPS -PP-Corp" startdate="${TASK_ENTRY_DATE}">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="02-OOPS-01-Corp"/>
         </field>
      </assignment-handler>
      <transition g="-5,-20" name="IMPT" to="Check OOPS or Roaming Report Flag"/>
      <transition g="-5,-20" name="Hold" to="Reset OOPS Flag "/>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="1" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="1" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="1" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="1" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="ContinueWorkflow" to="Reset Roaming Report Flag After  PP timeout">
       <script expr="1" g="0,0,80,40" var="PP_TIMEOUT_FLAG"/>
      </transition>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount">
      </transition>
      <transition g="-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="324,903:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
      <on event="timeout">
         <timer duedate="${P2P_CURRENT_DUE_DATE}" startdate="${TASK_ENTRY_DATE}"/>
         <event-listener class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment">
               <field name="actionName">
                  <string value="ExecuteEventAction"/>
               </field>
         </event-listener>
      </on>
   </task>
   <state continue="async" g="1226,602,255,52" name="Wait for AutoRelease Max Scheduled Time">
      <transition g="1433,689;1378,701:-5,-20" name="InvoiceBalance" to="Wait for AutoRelease Max Scheduled Time"/>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount"/>
      <transition g="-5,-12" name="ContinueWorkflow" to="Check PP flag">
         <timer duedate="${AUTOTIME}"/>
      </transition>
   </state>
   <decision g="1055,549,125,48" name="Check PP flag">
      <transition to="Wait Until Installment Due Date">
      </transition>
      <transition to="01-ROAM-PP-Cons">
         <condition expr="${PP_FLAG==&apos;1&apos;}"/>
      </transition>
      <transition to="01-ROAM-PP-Corp">
         <condition expr="${PP_FLAG==&apos;3&apos;}"/>
      </transition>
      <transition to="02-OOPS-PP-Cons">
         <condition expr="${PP_FLAG==&apos;2&apos;}"/>
      </transition>
      <transition to="02-OOPS -PP-Corp">
         <condition expr="${PP_FLAG==&apos;4&apos;}"/>
      </transition>
      <transition to="01-roam-pp-Cons-infinite">
         <condition expr="${PP_FLAG==&apos;5&apos;}"/>
      </transition>
      <transition to="02-oops-pp-Cons-infinite">
         <condition expr="${PP_FLAG==&apos;6&apos;}"/>
      </transition>
      <transition to="01-roam-pp-Corp-infinite">
         <condition expr="${PP_FLAG==&apos;7&apos;}"/>
      </transition>
      <transition to="02-oops -pp-Corp-infinite">
         <condition expr="${PP_FLAG==&apos;8&apos;}"/>
      </transition>
   </decision>
   <custom g="207,1660,275,52" name="Reset Roaming Report Flag After  PP timeout" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="UpdateWorkflowAttributeAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_PUB"/>
               </key>
               <value>
                  <object expr="ROAMING_REPORT_FLAG"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_TYPE"/>
               </key>
               <value>
                  <object expr="V"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="WORKFLOW_ATTR_VALUE"/>
               </key>
               <value>
                  <object expr="N"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Tickler For Broken Promise After PP Timeout"/>
   </custom>
   <custom g="201,1743,275,52" name="Tickler For Broken Promise After PP Timeout" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="TSHAction"/>
      </field>
      <field name="variables">
         <map class="java.util.HashMap">
            <entry>
               <key>
                  <string value="ACTION_TYPE"/>
               </key>
               <value>
                  <object expr="ALL"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="LDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="SHDES"/>
               </key>
               <value>
                  <object expr="Broken Promise"/>
               </value>
            </entry>
            <entry>
               <key>
                  <string value="TICKLER_TYPE"/>
               </key>
               <value>
                  <object expr="S"/>
               </value>
            </entry>
         </map>
      </field>
      <transition to="Cancel Payment Plan For Broken Promise After PP Timeout"/>
   </custom>
   <custom g="183,1839,335,52" name="Cancel Payment Plan For Broken Promise After PP Timeout" class="com.lhs.wma.wfms.jbpm4.WFMSActionAssignment" exception-listener="com.lhs.wma.wfms.jbpm4.WFMSExceptionHandler">
      <field name="actionName">
         <string value="CancelPaymentPlanAction"/>
      </field>
      <transition to="Check Task After Timeout"/>
   </custom>
   <decision g="328,2013,180,48" name="Check Task After Timeout">
      <transition to="01-roam-pp-Cons-infinite">
         <condition expr="${PP_TIMEOUT_FLAG==&apos;4&apos;}"/>
      </transition>
      <transition to="02-oops-pp-Cons-infinite">
         <condition expr="${PP_TIMEOUT_FLAG==&apos;3&apos;}"/>
      </transition>
      <transition to="01-roam-pp-Corp-infinite">
         <condition expr="${PP_TIMEOUT_FLAG==&apos;2&apos;}"/>
      </transition>
      <transition to="02-oops -pp-Corp-infinite">
         <condition expr="${PP_TIMEOUT_FLAG==&apos;1&apos;}"/>
      </transition>
   </decision>
   <task continue="async" g="16,1936,180,52" name="01-roam-pp-Cons-infinite">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="01-ROAM-04-FCRoam"/>
         </field>
      </assignment-handler>
      <transition g="125,1881;142,1895:-5,-20" name="IMPT" to="01-roam-pp-Cons-infinite"/>
      <transition g="174,1894;180,1893;191,1898:-5,-20" name="ContinueWorkflow" to="01-roam-pp-Cons-infinite"/>
      <transition g="-5,-20" name="Hold" to="Reset Roaming Report Flag ">
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="5" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="5" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="5" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="5" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount">
      </transition>
      <transition g="-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="168,949:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
   </task>
   <task continue="async" g="472,1756,180,52" name="02-oops-pp-Cons-infinite">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="02-OOPS-11-FCOOPS"/>
         </field>
      </assignment-handler>
      <transition g="584,1843;599,1824:-5,-20" name="IMPT" to="02-oops-pp-Cons-infinite"/>
      <transition g="670,1819;661,1794:-5,-20" name="ContinueWorkflow" to="02-oops-pp-Cons-infinite"/>
      <transition g="-5,-20" name="Hold" to="Reset Roaming Report Flag ">
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="6" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="6" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="6" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="6" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount">
      </transition>
      <transition g="484,1473:-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="300,920:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
   </task>
   <task continue="async" g="678,1816,180,52" name="01-roam-pp-Corp-infinite">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="01-ROAM-01-Corp"/>
         </field>
      </assignment-handler>
      <transition g="714,1909;682,1905:-5,-20" name="IMPT" to="01-roam-pp-Corp-infinite"/>
      <transition g="777,1889;764,1884;747,1879:-5,-20" name="ContinueWorkflow" to="01-roam-pp-Corp-infinite"/>
      <transition g="-5,-20" name="Hold" to="Reset Roaming Report Flag ">
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="7" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="7" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="7" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="7" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount">
      </transition>
      <transition g="-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="286,927:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
   </task>
   <task continue="async" g="807,1880,185,52" name="02-oops -pp-Corp-infinite">
      <assignment-handler class="com.lhs.wma.wfms.jbpm4.WFMSTaskAssignment">
         <field name="actionName">
            <string value="02-OOPS-01-Corp"/>
         </field>
      </assignment-handler>
      <transition g="909,1956;879,1950:-5,-20" name="IMPT" to="02-oops -pp-Corp-infinite"/>
      <transition g="961,1951;927,1953:-5,-20" name="ContinueWorkflow" to="02-oops -pp-Corp-infinite"/>
      <transition g="-5,-20" name="Hold" to="Reset Roaming Report Flag ">
      </transition>
      <transition g="-5,-20" name="ReleaseSD" to="Release SD">
      <script expr="8" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSuspension" to="Release Suspension">
      <script expr="8" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="ReleaseSDandSuspension" to="Release Suspension1">
      <script expr="8" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="AutoRelease" to="Wait for AutoRelease Max Scheduled Time">
      <script expr="8" g="0,0,80,40" var="PP_FLAG"/>
       </transition>
      <transition g="-5,-20" name="BrokenPromise" to="Tickler For Broken Promise"/>
      <transition g="-5,-20" name="Payment" to="Check Installment Amount">
      </transition>
      <transition g="-5,-20" name="Invoice" to="Check Commission Flag"/>
      <transition g="268,937:-5,-20" name="InvoiceBalance" to="Check Commission Flag"/>
   </task>
   <decision g="58,884,145,48" name="Decide Next state">
      <transition to="Provisioning Wait Between Release Suspension and Release SD">
         <condition expr="${PROV_PAY_FLAG==&apos;1&apos;}"/>
      </transition>
      <transition to="Provisioning Wait Forever After Release">
         <condition expr="${PROV_PAY_FLAG==&apos;2&apos;}"/>
      </transition>
      <transition to="Wait Until Installment Due Date">
         <condition expr="${PROV_PAY_FLAG!=&apos;1&apos; &amp;&amp; PROV_PAY_FLAG!=&apos;2&apos;}"/>
      </transition>
   </decision>
</process>